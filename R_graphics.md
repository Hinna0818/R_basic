## 绘制图像（graphics）

### 一、基本绘图函数
最简单的是`plot()`函数，对于一个二维平面图，直接扔两个参数进去画即可。而在这基本函数中，存在很多其他的参数，比如图像点/线的颜色和大小、标题、图例、坐标轴宽度长度范围、文本标注等等。同时，也有很多包支持多元化的绘图，如喜闻乐见的`ggplot2()`、`ggtree()`等等，掌握他们基本的语法是很重要的。

要注意的是，使用`lines`或者`points`函数前必须先初始化图像，因为这两个函数都是在已有图像上进行绘制的。可以使用以下方法来进行初始化：
```R
# 初始化绘图区域
plot(0, 0, type = "n", xlim = c(0, 1), ylim = c(0, 1))
```
其中，我设置了`type = "n"`，这意味着该图像是空白的，方便我后续使用`lines`,`points`,`text`等函数进行绘制。

<br>


<mark>画点（symbol）函数：  

`points()`函数可以在已有图形上标注点的位置，并能设置点的大小与形状。画图的数据一般是两个向量或者数据框的两列，第一列为x，第二列为y：
```R
x <- rnorm(10)
y <- rnorm(10)

##标注出两个点，用蓝色标记
plot(x,y)
points(c(0,1),c(1,0),col = "blue", pch = 19)
```  
结果如图：
![alt text](image-2.png)

<br>

<mark>画图的参数

函数`lines()`和`points`都可以设置`type`参数，控制此参数可以改变输出线或者点的形状，具体如下：
```R
##绘制线段
lines(x, y, type = "l") #type默认为l

##常见type种类：
"p": 绘制点 (points默认值)。
"l": 绘制线 (lines默认值)。
"b": 同时绘制点和线。
"o": 绘制点和线，且线覆盖点。
"h": 绘制直方图的竖线。
"s": 绘制阶梯函数（在y值变化后再水平移动）。
"S": 绘制阶梯函数（在x值变化后再垂直移动）。
"n": 不绘制点或线，仅创建绘图框架。
```

具体效果：
![alt text](2a6fdf2f483d5de5357411b4aabdf11.png)

<br>

其他的参数：
`col`控制线条的颜色，`lwd`控制线条的宽度（默认为1），`lty`控制线的类型（line type）：
![alt text](85572a0bdc8a7ce1144ae8770aacc39.png)

举个例子：
```R
plot(0, 0, type = "n")
lines(x,y, type = "o", col = "red", lty = 2)
```

![alt text](image-3.png)

<br>

<mark>绘制多边形（polygon）

使用`polygon`函数进行多边形的绘制，需要传入两个长度相同的向量，R会自动连接第一个顶点和最后一个顶点，以构成封闭的图形：
```R
##示例
plot(-1:1,-1:1,type = "n")
polygon(x, y, col = "lightblue", border = "blue")
```
![alt text](image-4.png)

一些补充的参数如下：  
```R
col: 填充多边形的颜色，可以是颜色的名称或代码。如果为 NULL，则不填充颜色。

border: 多边形边界的颜色。默认为 NULL，表示使用默认边框颜色。如果不希望绘制边框，可以将其设为 NA。

lty: 边界线的线型，可以是从 1 到 6 的数字，也可以是线型的名称（如 "solid"、"dashed"）。

lwd: 边界线的宽度。

density: 用于填充多边形的阴影线的密度。如果为 NULL，则不使用阴影线填充。

angle: 阴影线的角度，单位为度。
```
<br>

<mark>标注直线

`abline` 函数是 R 语言中的一个图形函数，用于在现有图形中添加直线。它可以添加不同类型的直线，如水平线、垂直线或斜率线。以下是 `abline` 函数的一些常见用法：
```R
#基本语法
abline(a = NULL, b = NULL, h = NULL, v = NULL, ...)

##a为直线的截距、b为直线的斜率、h为水平线的高度（指定在y轴上的位置）、v为垂直线（指定在x轴上的位置）

##举例
abline(h = 10, col = "lightblue") #添加高度为10的水平线 
```

<br>



<mark>文本标注

`text`函数在 R 中用于在绘图区域内的指定位置添加文本标签。它非常有用，可以用来标注点、线、多边形或者在图中其他位置添加注释：
```R
#基本语法
text(x, y, labels, pos = NULL, offset = 0.5, vfont = NULL, cex = 1, col = NULL, font = NULL, ...)

#参数解释
x, y: 文本标签的位置坐标。x 和 y 可以是数值向量，也可以是单个数值，表示文本的起始位置。

labels: 要显示的文本内容。可以是字符向量或表达式。

pos: 文本的位置，相对于给定的坐标，可以是1（下方），2（左侧），3（上方），4（右侧）。如果不指定，文本会直接在指定的 x, y 坐标上显示。

offset: 仅当 pos 参数指定时有效，表示文本与指定位置的距离，默认为 0.5。

vfont: 文本的字体（矢量字体），通常不用指定。

cex: 文本的大小，默认值为1。

col: 文本的颜色，默认值为黑色。可以是颜色名称或颜色代码。

font: 文本的字体类型，1 = 常规，2 = 粗体，3 = 斜体，4 = 粗斜体。

#示例
plot(1:10, 1:10, type = "p")
text(5, 5, "centre", col = "red", cex = 1.5)
```
![alt text](image-5.png)

我画了一些图发现，如果文本信息过多，可能会导致覆盖，而且在R中调整比较麻烦。可以考虑使用`ggplot2`的函数进行处理。

<br>


<mark>设置边框

在 R 的绘图系统中，`box` 参数主要用于控制图形的边框，特别是在一些高级绘图函数中，如 `plot()` 或 `title()`。
```R
#用法
plot(...)
box() #设置了box参数，即选择绘制边框
```
<br>

<mark>设置坐标轴

`axis `参数控制坐标轴的显示方式，包括坐标轴的标签、刻度线和线条的外观等。在 R 的基础图形系统中，`axis` 参数通常用于以下函数：
```R
##用法
plot(..., xaxt = , yaxt = ) #在plot中可以设置xaxt和yaxt来显示坐标轴，默认为"s"，"n"为不显示

#还可以
axis(1)  #设置x轴
axis(2)  #设置y轴
```

<br>



### 二、图像设置（Graphic settings）
`par`函数用于设置或查询图形参数。它可以控制图形设备的各个方面，比如图形的布局、边距、坐标轴和符号样式等，以下是基本用法：
```R
#设置图形参数
par(mfrow = c(2,2)) #设置为两行两列的布局

#查询当前参数
print(par(mfrow)) #打印当前的布局情况

#设置图像边距
par(mar = c(5,4,3,1,2))

#恢复默认设置
old_par <- par(no.readonly = TRUE) #保存当前可修改的变量

#更改绘图参数......
par(old_par) #恢复
```
注意：`par()` 修改的图形参数是全局的，影响当前设备上的所有后续图形。要临时修改某些参数，可以在绘图函数中直接设置这些参数，而不是使用 `par()`。例如，在 `plot()` 函数中直接设置 `col = "red"` 只会影响当前图形的颜色，不会影响后续的图形。


<br>

`mar` 是 R 中的一个图形参数，用于设置绘图区域的边距。`mar` 参数指定了绘图区域四个边的边距大小，分别对应下方、左侧、上方和右侧，单位为文本行数。
```R
#mar的默认值
 par("mar")
[1] 5.1 4.1 4.1 2.1

#设置mar参数
par(mar = c(a,b,c,d))
```

<br>

#### 颜色（color）
在编程语言中，一般使用RGB颜色。它通过组合红色（Red）、绿色（Green）和蓝色（Blue）三种基本颜色的强度来生成其他颜色。在计算机图形学和显示器中，颜色通常用 RGB 模型来表示。在某些编程语言或图形软件中，RGB 颜色也可以用十六进制字符串表示，如 `"#FF0000"` 表示纯红色，`"#00FF00"` 表示纯绿色，`"#0000FF"` 表示纯蓝色。这些代码颜色可以在网上搜索。

`palette` 函数的调色板在 R 语言中主要用于控制绘图中所使用的颜色，尤其是在涉及到多个分组或者分类变量的情况下。调色板的颜色可以循环运用到不同的图中，它的作用包括：
```R
#查看当前的调色板情况
palette()
[1] "black"   "#DF536B" "#61D04F" "#2297E6" "#28E2E5" "#CD0BBC" "#F5C710"  "gray62"

#设置新的调色板
palette(c("red", "green", "blue"))
```

<br>

#### 绘图准备设置
可以使用`plot.new`函数进行绘图空间的初始化，这个函数可以新开一个空白空间来绘制图像，一般再次使用`plot`函数画图时会自动调用；`plot.window`函数则是用来设置绘图的一些参数，具体用法如下：
```R
##开启一个新的绘图空间
plot.new()

##设置当前空间的基本绘图参数
plot.window(xlim, ylim)

#举例
plot.window(xlim = c(1,10), ylim = c(1,1000), log = "y")
```

<br>

如果想在同一个图上进行不同图像的绘制，可以使用`matplot()`函数。`matplot` 函数在 R 语言中用于绘制多列或多行数据的图表，特别适用于矩阵或数据框。当有多个数据系列需要在同一张图中显示时，可以使用 `matplot`：
```R
#基本语法
matplot(x, y, type = "p", lty = 1, lwd = 1, col = 1)

##x,y为矩阵或数据框，通常x要固定，y变化，相当于在同一个x轴下画不同y的图像。
```

<br>

### 三、常用的绘图函数

<mark>条形图（boxplot）

在 R 语言中，`barplot()` 函数用于绘制条形图（Bar Plot），这是一种常见的可视化方法，用于显示分类数据的频率、计数或其他度量值。
```R
#语法
barplot(height, ...)
#height: 这是一个数值向量或矩阵，表示条形图的高度。如果是矩阵，每一列会作为一个条形显示。
```
同时，如果设置`beside = TRUE`，条形会并排显示，如果为`FALSE`，那么就是堆叠显示（默认）；设置`horiz = TRUE`，可以将条形图调整为水平显示；

<br>

<mark>直方图（histogram）

在 R 语言中，`hist()` 函数用于绘制直方图（Histogram）。直方图是一种常见的图形表示方法，主要用于显示数据的分布情况。
```R
#语法
hist(x, ...) #x为数值向量

##常用参数
breaks: 控制直方图中条形的数量或断点，可以是一个数字（表示条形的数量），也可以是一个数值向量（指定每个区间的断点）。

freq: 逻辑值。如果为 TRUE，条形的高度表示频数（默认）；如果为 FALSE，高度表示密度。

col: 设定条形的颜色。

main: 设定图形的标题。
```

<br>

直方图与条形图的区别：  
连续变量一般用于直方图的绘制，分类变量一般用于条形图的绘制

<br>

<mark> 箱线图（boxplot）

在R中，`boxplot`函数用于创建箱线图（box plot），它是用于显示数据的分布情况，特别是数据的中心位置、变异程度以及异常值的一种图形方法，一般用于连续变量。以下是`boxplot`函数的基本用法：
```R
#语法
boxplot(x, ...) #x可以是一个数值向量，也可以是数据框

#绘制多个数据集的箱线图
data1 <- c(5, 7, 8, 9, 10)
data2 <- c(12, 15, 16, 18, 22)
boxplot(data1, data2, names=c("Group 1", "Group 2"), main="Boxplot of Two Groups", ylab="Values", col=c("lightblue", "lightgreen"))
```
示例：
![alt text](image-6.png)

<br>

<mark>等高线图（contour plot）

`Contour plots` 用于表示三维数据的二维视图，其中等高线表示数据值的变化。等高线图非常适合于显示数据的趋势和分布，尤其是在地理信息系统（GIS）和科学数据分析中。
```R
#基本用法
contour(x, y, z, ...) #x,y为坐标轴的取值范围，z是一个函数，生成了一个二维网格上的数据值

#举例
# 数据
x <- seq(-10, 10, length=100)
y <- seq(-10, 10, length=100)
z <- outer(x, y, function(x, y) sin(sqrt(x^2 + y^2)))

# 创建等高线图
contour(x, y, z, main="等高线图", xlab="X", ylab="Y")
```
如下：
![alt text](image-7.png)

<br>

补充一下`outer()`函数：`outer` 函数是 R 中用于计算两个向量的外积的函数，它生成一个矩阵，其中每个元素是两个向量对应元素的函数值。常用于创建网格数据，特别是在绘制等高线图和热图时非常有用。
```R
#语法
outer(X, Y, FUN = "*", ...) #x，y为两个向量，FUN为定义的函数，默认为乘法
```

<br>

<mark>热图（Heatmap）

热图用于通过颜色的变化来展示数据的数值分布，适用于显示矩阵数据中的模式和关系。热图特别适合于展示数据的密度或强度。在R中，可以使用`heatmap()`函数绘制热图：
```R
#语法
heatmap(data, ...) #data为一个矩阵，结果的颜色越深说明该数据越大

#示例
matrix_data <- matrix(rnorm(100), nrow=10)
heatmap(matrix_data, xlab="X", ylab="Y")
```
如下：
![alt text](image-8.png)

<br>

在本章的最后，我来讨论一下图形的导出问题：  
如果想导出为PDF文件，可以使用：
```R
pdf("my_plot.pdf", width=8, height=6)  #打开pdf设备

# 绘制图形
plot(1:10, rnorm(10), main="...", xlab="...", ylab="...")

# 关闭图形设备
dev.off()
```

`dev.off() `是用于关闭当前图形设备的函数。当在 R 中绘制图形时，图形被送到一个图形设备（例如，屏幕设备或文件设备），需要使用 `dev.off()` 来关闭当前的图形设备，确保图形被正确保存并释放设备资源。通常，`dev.off()`会搭配`dev.new`一起使用。


#### 总结  
在 R 的绘图函数中，有一些常见的参数用于控制图形的外观和行为。以下是常见的绘图函数参数及其简要说明：
  
1. plot 函数的常见参数
x 和 y: 数据的 x 轴和 y 轴值。  
type: 绘图类型，如 "p"（点图）、"l"（线图）、"b"（点线图）、"h"（直方图）、"o"（点线图）、"s"（阶梯图）、"n"（不绘制任何图形）。  
xlab 和 ylab: x 轴和 y 轴的标签。  
main: 图形的主标题。  
sub: 副标题。  
col: 点、线、文字等的颜色。  
pch: 点符号的类型，如 1（圆点）、2（方块）、3（三角形）等。  
lty: 线型，如 1（实线）、2（虚线）、3（点划线）等。  
lwd: 线宽度。  
cex: 字体大小和点的大小的缩放因子。  
xlim 和 ylim: x 轴和 y 轴的范围。  
axes: 是否绘制坐标轴（TRUE 或 FALSE）。  

<br>

2. par 函数的常见参数
mfrow 和 mfcol: 设置图形设备的布局，mfrow=c(nr, nc) 按行分布，mfcol=c(nr, nc) 按列分布。  
mar: 图形边距，设置为一个包含下、左、上、右的数值的向量。  
mai: 图形边距，单位为英寸。  
oma: 外部边距，设置为一个包含下、左、上、右的数值的向量。  
las: 坐标轴标签的方向（0、1、2、3）。  
cex: 字体大小的缩放因子。  
bg: 背景颜色。  
col: 默认颜色。  
lty: 默认线型。  
pch: 默认点符号。  

<br>

3. ggplot2 的常见参数
data: 数据框，绘图数据。  
aes: 映射美学属性，如 x、y、color、size、fill。  
geom: 图形几何对象，如 geom_point()（散点图）、geom_line()（线图）、geom_bar()（条形图）。  
labs: 标签，设置标题和轴标签。  
theme: 主题，调整图形的外观，如 theme_bw()、theme_minimal()。  
facet_wrap 和 facet_grid: 面板分面，用于分面显示多个子图。  
scale_color 和 scale_fill: 控制颜色和填充的尺度。  









